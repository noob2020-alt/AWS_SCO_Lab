# AWS Security Operations Lab Setup

### Creating the VPC

Navigate to VPC:

![[Pasted image 20241013130521.png]]



Click the ==Create VPC== button and change the following setting:
Name tag - optional 
Leave all other options as default
![[Pasted image 20241012102928.png]]


After changing the Name tag, click ==Create VPC==
![[Pasted image 20241012103030.png]]


Take note of the Name and the IPv4 CIDR
The IPv4 CIDR will be used throughout the setup to allow traffic flow through the VPC
![[Pasted image 20241012103242.png]]

### Creating a AWS Key pair

NOTE: The following OS may be beneficial to use different key type:
Windows - suggested to use .ppk with PuTty
Unix/Linux - suggested to use .pem keys

For this instruction we are using a Unix/Linux OS

Next head to EC2 > Key pairs > Create key pair

![[Pasted image 20241011214223.png]]


![[Pasted image 20241011214306.png]]


Once created the key will automatically download to your system:

![[Pasted image 20241011214448.png]]



### Configuring the Security Onion AMI Instance (Prelaunch)

Click the EC2 tab and select =="Launch instances"==
==NOTE: Charges are included as long as the instance is on so ensure to shutdown after use==

On the left hand pane click Instances > Launch Instances
![[Pasted image 20241011214742.png]]

Browse more AMIs

![[Pasted image 20241011214912.png]]

Enter "Security Onion" and click enter and select the Security Onion AMI

![[Pasted image 20241012104149.png]]




Select the Key pair you create or create a new one
![[Pasted image 20241012104337.png]]


### Configuring Security Onion AMI Network Settings
Ensure the following settings are applied: -- ==Click Edit==
VPC - Use the one you create initially
Subnet - Public1
Security Group Name - SecOnionManager (Or the name of your choosing)
Description - Mgmt_SG (Or the name of your choosing)
![[Pasted image 20241012105404.png]]

#### Inbound Security Group Rules

Things to do:
Add two security group rules
Add an additional network interface (monitoring/sniffing)

##### Add two security group rules
Adjust the sections in each new rule to match the screenshot
Rule3 allows all traffic to the IP
Rule 4 allows traffic flow through the VPC
![[Pasted image 20241012110407.png]]


##### Add an additional network interface (monitoring/sniffing)

Click Advanced network configuration
![[Pasted image 20241012110712.png]]
Leave the Defaults and click "Add network interface"
![[Pasted image 20241012110833.png]]

![[Pasted image 20241012111018.png]]

You are ready to launch the instance
### Launch the instance

![[Pasted image 20241012111205.png]]




### AWS Network Configuration Post Security Onion Launch

Things to do:
Associate an Elastic Public IP
Ensure the Public IP is connect
Create a Security Group for the Sniffing Interface (and remove the interface from the Manager Security Group)
Add traffic rules
##### Associate an Elastic Public Ip

In the left pane under Network & Security, Click Elastic IPs
Click "Allocate Elastic IP address"
![[Pasted image 20241012112752.png]]

Leave the defaults and click Allocate
![[Pasted image 20241012112848.png]]

Edit the IP name and take note of the Allocated IP
![[Pasted image 20241012113005.png]]

![[Pasted image 20241012113242.png]]

##### Ensure the Elastic Public IP is Properly Allocated

Navigate and click Instance > your instance > and scroll down: 
Ensure there is a Public IPv4 address 
If not, create and allocate a new Elastic IP
![[Pasted image 20241012114720.png]]

In the Network tab scroll to the bottom and take note of which interface the public IP is allocated to:
![[Pasted image 20241012114609.png]]

These interfaces will enable us to set the appropriate security group and traffic monitoring rules later.

##### Create a Security Group for the Sniffing Interface

In the left pane under Network & Security, click on Security Groups (SG)
Click on "Create security group"
Select your desired name keeping in mind that this is the sniffing interface SG
Ensure the "Sniffing SG" has the follwing inbound and outbound rules

Inbound Rules:
![[Pasted image 20241012115339.png]]
This allows all traffic inbound on the sniffing from the VPC

Outbound Rules:
![[Pasted image 20241012115501.png]]

Next, head back to the Interface > Network tab an click on the interface that "IS NOT" allocated to the Elastic IP:
![[Pasted image 20241012115837.png]]

NOTE: By default, The Security Onion instance is launched with both interfaces belonging to the initial security group (management). The following steps must be taken to ensure the monitoring interface has its own Security Group:

In the left pane go to Network & Security > Interfaces > and select the sniffing interface. Click on Actions > Change security groups
![[Pasted image 20241012120155.png]]

In the dropdown menu add the sniffing security group you created:
![[Pasted image 20241012120314.png]]

Next click Remove to disassociate the sniffing network from the "Management SG" (or the main SG associated to the Security Onion instance)
![[Pasted image 20241012120416.png]]

Click Save

Check to ensure both interfaces are in their respective security groups:
Manager Interface:
![[Pasted image 20241012120613.png]]

Sniffing Interface:
![[Pasted image 20241012120701.png]]








